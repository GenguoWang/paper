\chapter{实验评估}
\label{chap:evaluation}
本章中，我们通过在两个比较有代表性的数据集上进行测试来对我们的系统进行各方面的评估。我们的主要评估手段是比较我们的系统和直接计算之间的性能差异，以及比较这两种方式能偶处理数据的规模。

首先，我们对树状证明进行了单独的测试。我们通过比较用树状证明方式生成正确性证明和直接计算正确性证明的时间效率，来评估树状证明带来的性能提升。然后，我们对系统的整体性能做了测试，使用的是一次任务的总时间，包括搜索时间、生成正确性证明的时间、生成可靠性证明的时间。

\section{数据集}

在我们这次的实验评估中，我们使用了两个数据集：一个是Enron Email, 另一个是Wikipedia。

\textbf{Enron Email} 该数据集是一些用户电子邮件的合集，都是一些txt格式的文本文件。该数据集有着类似一般用户日常使用的规模。我们选择了其中用户Mann-k的电子邮件，用来测试我们的系统在一般用户日常使用时的性能表现。

\textbf{Wikipedia} 该数据集是维基百科的英文版本数据集，文档内容是以HTML各个的文本文件进行存储。该数据集数据规模较大，在我们的测试环境里无法使用直接计算的方式进行处理。我们使用该数据来测试我们的系统应对大规模数据的情况。

在表\ref{tab:dataset_stat}里，我们给出了这两个数据集的一些具体数据情况。在每个数据集上我们都选择了6个比较费时间的查询来进行考验效率的情况下的测试，同时我们也随机选择了一些常见的查询来进行一般情况下的性能测试。
\begin{table}[htb]
    \centering
    \caption{数据集}
    \begin{tabular}{cccccc}
        \toprule
        数据集 & 文档数目 & 词条数目 & 大小 \\
        \midrule
        Enron & 46,762 & 69,937 & 100MB  \\
        Wikipedia & 1425,7486 & 13,320,882 & 101GB  \\
        \bottomrule
    \end{tabular}
    \label{tab:dataset_stat}
\end{table}

\section {测试环境}

我们的测试环境是一个包含12台机器的集群。我们的测试不包含系统的初始化时间，在系统初始化好后，不再进行文件的读写操作，所以硬盘速度的影响我们不考虑。我们使用了该机群搭建的NAS来存储我们的索引文件和事先计算的数据，而不使用本地磁盘。所以在这里我们就不关注本地的磁盘配置了。每台机器的配置如下：

\begin{itemize}
    \item \textbf{CPU} 2个Intel E5645 2.40GHz
    \item \textbf{内存} 64GB
    \item \textbf{网络} 1000Mbps
\end{itemize}

\section {正确性证明的性能比较}
\begin{table}[htb]
    \centering
    \caption{正确性证明的生成速度提升}
    \begin{tabular}{cccccc}
        \toprule
        查询编号 & 直接计算时间(s) & 树状证明时间(s) & 速度提升 \\
        \midrule
        1 & 1.177 & 0.672 & 1.752  \\
        2 & 8.931 & 1.272 & 7.022  \\
        3 & 0.703 & 0.387 & 1.818  \\
        4 & 1.267 & 0.823 & 1.540  \\
        5 & 1.631 & 0.987 & 1.653  \\
        6 & 1.016 & 0.649 & 1.565  \\
        \midrule
        平均 & 2.454 & 0.798 & 2.558  \\
        \bottomrule
    \end{tabular}
    \label{tab:correctness_speedup}
\end{table}

由于本测试的数据规模不是很大，我们是使用一台集群中的机器进行。测试的数据结果如表\ref{tab:correctness_speedup}所示。从测试结果来看，我们的树状证明方式相比于直接计算大概有着1.5倍左右的提升。对于那些计算时间比较长的查询，我们的方式的提升效果更加明显。比如说这次测试中的查询2，使用的关键词是"message"和"queue"，其中"message"对应的倒排索引数据的大小为46762，"queue"对应的倒排索引数据的大小为188。最后搜索结果集合的大小是188，说明这里恰巧包含queue的文档都包含message这个关键词。对于这么大的集合，用直接计算的方法，生成正确性索引需要8.931秒，而是用我们的树状证明则只需要1.272秒。这可以说明，树状证明比较适合处理集合元素比较多的情况。


\section {总体性能测试}

\begin{table}[htb]
    \centering
    \caption{总体提升}
    \begin{tabular}{cccccc}
        \toprule
        查询编号 & 直接计算时间(s) & 本系统时间(s) & 速度提升 \\
        \midrule
        1 & 1.819 & 0.840 & 2.165 \\
        2 & 9.051 & 2.278 & 3.973 \\
        3 & 1.066 & 0.498 & 2.143 \\
        4 & 1.984 & 1.064 & 1.866 \\
        5 & 2.497 & 1.272 & 1.962 \\
        6 & 1.512 & 0.801 & 1.888 \\
        \midrule
        平均 & 2.988 & 1.125 & 2.333 \\
        \bottomrule
    \end{tabular}
    \label{tab:overall_speedup}
\end{table}

我们使用了Enron Email数据集在一台机器上进行了本次测试。
测试结果如表\ref{tab:overall_speedup}中所示。从测试结果中，我们可以看出我们的系统相比于直接计算的方式有着差不多2倍的速度提升。由于我们采用了正确性证明和完整性证明并行计算的方法，我们的系统的计算时间主要取决于正确性证明和完整性证明中计算的比较慢的那个。而直接计算时，总的时间是这两个部分证明的计算时间之和。在大部分情况下，这两个部分的证明计算时间都差不多，所以我们的系统的提升倍数也在2倍左右。对于查询2，得益于树状证明在正确性证明计算上带来的巨大提升，总体性能有着比别的查询更加明显的提升。

\section{验证时间的比较}
\begin{table}[htb]
    \centering
    \caption{验证时间的比较}
    \begin{tabular}{cccccc}
        \toprule
        查询编号 & 直接计算(s) & 本系统(s) \\
        \midrule
        1 & 0.520 & 0.452 \\
        2 & 0.271 & 0.197 \\
        3 & 0.492 & 0.442 \\
        4 & 3.532 & 3.241 \\
        5 & 4.705 & 4.324 \\
        6 & 0.979 & 0.904 \\
        \midrule
        平均 & 1.750 & 1.593 \\
        \bottomrule
    \end{tabular}
    \label{tab:verifying_time}
\end{table}
为了测试在提升了证明生成速度之后，我们的系统会不会对证明的验证速度有着不好的影响，我们使用Enron数据集进行了验证时间的测试。测试结果如表\ref{tab:verifying_time}中所示。从测试结果中，我们可以看出我们的系统的证明验证速度比直接计算有着大约10\%左右的降低，这个程度的降低相比较证明速度的提升是完全可以接受的。本系统验证速度降低的主要原因是使用了树状证明，正确性验证需要多验证一些Membership Witness。还有，这里的证明验证没有使用事先计算的质数，所以每次验证都要计算大量的质数表示，这导致了证明验证的时间和证明生成的时间都差不多了。我们可以让云端在返回搜索结果的同时返回签了名的相应的质数表示，这样用户在证明验证的时候就不需要再进行质数表示的计算了。当然，这样会增加返回结果的大小。对这里的权衡关系，本课题没有进行深入的研究。

\section {大数据集的性能测试}
\begin{table}[htb]
    \centering
    \caption{Wikipedia数据集上的性能测试结果}
    \begin{tabular}{cccccc}
        \toprule
        查询编号 & 耗时(s) \\
        \midrule
        1 & 706.038  \\
        2 & 8.096  \\
        3 & 209.649  \\
        4 & 7.677  \\
        5 & 770.438  \\
        6 & 87.117  \\
        \midrule
        平均 & 298.169  \\
        \bottomrule
    \end{tabular}
    \label{tab:wiki_speedup}
\end{table}
本测试我们使用的是Wikipedia数据集，在10台机器上进行。测试结果如表格\ref{tab:wiki_speedup} 所示。从测试结果中，我们可以看出我们的系统能够对100GB数据规模的数据集进行处理，但处理速度还不是很好，而且不同查询的处理速度有着很大的变化。对于有些查询，我们的系统能够在10秒内给出结果，而对于一些别的查询，处理时间却长达10分钟。
\section{本章小结}
本章我们对我们的云搜索快速验证系统进行了一系列的实验评估。实验评估的内容主要为树状证明对正确性证明生成速度的提升、本系统的整体性能评估、系统对于大规模数据集的处理能力评估。

实验评估结果表明，我们的系统对于该验证机制下的直接计算有着不错的提升，也能处理比较大规模的数据，但也存在着处理大规模数据是效率打不到实用级别的问题。
